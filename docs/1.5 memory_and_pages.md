# S memory management

## 用户可用的内存（无 SBI）

我们可以假装放一个很大的数组，并宣称它就是我们的用户可用的内存。我们只需要在链接脚本里指定这个内存应当处在的位置。

我们在链接脚本中使用 ``PROVIDE`` 命令标记内核占用的内存的末段，并将紧随其后的若干「页」指定为用户可用的内存。

一方面，我们定义变量：

``` C
extern char pmem_base[];
```

然后，我们在链接脚本的 ``SECTION`` 部份的末段指定：

```
  PROVIDE(pmem_base = .)
```

这样将对应的地址导出成了符号。

当然，事实上，在这里我们还没有划分出真正的页。所以我们只是简单地约定一个物理内存的上限：

``` C
#define PMEM_END (PMEM_START + 128 * 1024 * 1024)
```

事实上这就是我们一开始在编译选项中定义的 ``128 mb`` 内存。也就是说，我们将所有除了内核占用的几个段以外的内存都划成用户能访问的物理页。

然后用一个链表维护这个物理页池即可。